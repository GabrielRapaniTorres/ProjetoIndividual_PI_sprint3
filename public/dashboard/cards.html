<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="icon" href="../assets/imgs/png-transparent-music-note-music-note-musical-notes-musical-design-symbol-sound-melody-music-notes-v.svg">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Musical | VibeTrack</title>
    <link rel="stylesheet" href="../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet" />

</head>
<style>



.fundo {

    background-image: url(../assets/imgs/luxa.org-opacity-changed-._van-gogh-noite-estrelada-sobre-rodano-d.jpg);
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
}
.secao-jogo {
    text-align: center;
    color: white;
    font-family: 'Quicksand', sans-serif;
}
.header {
    background-color: rgba(0, 0, 0, 0.7);
    padding: 20px;
    text-align: center;
}

</style>
<body>

    <div class="fundo">


        <div class="header">
            <div class="container">
                <h1 class="titulo">VibeTrack</h1>
                <ul class="navbar">
                    <li>
                        <a href="../index.html">inicio</a>
                    </li>
                    <li>
                        <a href="../simulador.html">Sobre</a>
                    </li>
                    <li>
                        <a href="../login.html">Login</a>
                    </li>
                    <li>
                        <a href="../cadastro.html">Cadastro</a>
                    </li>
                    <li class="agora">
                        <a href="cards.html">quiz</a>
                    </li>
                    <li>
                        <a href="dashboard.html">dashboard</a>
                    </li>
                    <li>
                        <a href="mural.html">forum</a>
                    </li>
                </ul>
            </div>
        </div>
    
        
        <section class="secao-jogo">
            <button id="iniciar-jogo-btn">Iniciar Quiz Musical!</button>
    
            <div id="jogo-container" class="oculto">
                <div id="pergunta-container">
                    <p id="pergunta"></p>
                </div>
                <div id="respostas-container">
                    <button class="resposta-btn" data-index="0"></button>
                    <button class="resposta-btn" data-index="1"></button>
                    <button class="resposta-btn" data-index="2"></button>
                    <button class="resposta-btn" data-index="3"></button>
                </div>
                <div id="feedback-container" class="oculto">
                    <p id="feedback-mensagem"></p>
                    <button id="proxima-pergunta-btn">Próxima Pergunta</button>
                    <div class="grafico-container">
                        <p>acertos da comunidade:</p>
                        <canvas id="grafico1"></canvas>
    
                    </div>
                </div>
            </div>
    
            <div id="resultado-final">
                <h2>Parabéns!</h2>
                <p id="mensagem-resultado"></p>
                <button onclick="location.reload()">Reiniciar Quiz</button>
            </div>
        </section>
    </div>
    <footer>


  <p>©VibeTrack 2025</p>
  <div> <h2>Desenvolvido por Gabriel Rapani Torres, com o auxilio dos professores (SPtech)</h2>  </div>
<p>version 1.0</p>
</footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const iniciarJogoBtn = document.getElementById('iniciar-jogo-btn');
            const jogoContainer = document.getElementById('jogo-container');
            const perguntaContainer = document.getElementById('pergunta');
            const respostasContainer = document.getElementById('respostas-container');
            const feedbackContainer = document.getElementById('feedback-container');
            const feedbackMensagem = document.getElementById('feedback-mensagem');
            const proximaPerguntaBtn = document.getElementById('proxima-pergunta-btn');
            const resultadoFinal = document.getElementById('resultado-final');
            const mensagemResultado = document.getElementById('mensagem-resultado');
            const respostaBotoes = document.querySelectorAll('.resposta-btn');
            let chart; 

            async function atualizarGrafico(idPergunta) {
                const ctx = document.getElementById('grafico1').getContext('2d');
                try {
                    const resposta = await fetch(`/quiz/estatisticas/${idPergunta}`);
                    const dados = await resposta.json();

                    let acertos = 0;
                    let erros = 0;
                    dados.forEach(item => {
                        if (item.correta === 1) acertos = item.quantidade;
                        else erros = item.quantidade;
                    });

                    if (!chart) {
                        chart = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: ['erros', 'acertos'],
                                datasets: [{
                                    label: 'Respostas do quiz',
                                    data: [erros, acertos],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            }
                        });
                    } else {
                        chart.data.datasets[0].data = [erros, acertos];
                        chart.update();
                    }
                } catch (error) {
                    console.error("Erro ao buscar estatísticas:", error);
                }
            }

            const perguntas = [
                {
                    pergunta: "Qual instrumento é conhecido como 'o rei dos instrumentos'?",
                    respostas: ["Violino", "Guitarra", "Piano", "Bateria"],
                    respostaCorreta: 2
                },
                {
                    pergunta: "Quem é conhecido como o 'Rei do Pop'?",
                    respostas: ["Prince", "Madonna", "Elvis Presley", "Michael Jackson"],
                    respostaCorreta: 3
                },
                {
                    pergunta: "Qual destes gêneros musicais se originou em Nova Orleans, EUA?",
                    respostas: ["Blues", "Jazz", "Country", "Rock and Roll"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Qual compositor clássico é famoso por suas 'Nove Sinfonias'?",
                    respostas: ["Mozart", "Beethoven", "Bach", "Chopin"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Qual artista brasileira popularizou o 'axé music' nos anos 90?",
                    respostas: ["Marisa Monte", "Gal Costa", "Ivete Sangalo", "Daniela Mercury"],
                    respostaCorreta: 3
                },
                {
                    pergunta: "Qual destes álbuns é considerado um marco do rock progressivo?",
                    respostas: ["Dark Side of the Moon", "Abbey Road", "Back in Black", "Hotel California"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Quem compôs a famosa ópera 'Carmen'?",
                    respostas: ["Verdi", "Puccini", "Bizet", "Wagner"],
                    respostaCorreta: 2
                },
                {
                    pergunta: "Qual destes instrumentos é de cordas?",
                    respostas: ["Flauta", "Trompete", "Violão", "Bateria"],
                    respostaCorreta: 2
                },
                {
                    pergunta: "Quem é conhecido como o 'Pai do Blues'?",
                    respostas: ["Robert Johnson", "B.B. King", "Muddy Waters", "Howlin' Wolf"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Qual destes festivais é famoso por sua conexão com a música psicodélica?",
                    respostas: ["Lollapalooza", "Woodstock", "Coachella", "Glastonbury"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Qual destes artistas é conhecido por seu estilo de vida extravagante e performances teatrais?",
                    respostas: ["David Bowie", "Freddie Mercury", "Elton John", "Prince"],
                    respostaCorreta: 2
                },
                {
                    pergunta: "Qual destes gêneros musicais é caracterizado por seu ritmo rápido e letras de protesto?",
                    respostas: ["Reggae", "Punk Rock", "Samba", "Funk"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Quem é o cantor principal da banda britânica Coldplay?",
                    respostas: ["Chris Martin", "Bono Vox", "Thom Yorke", "James Blunt"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Qual destes instrumentos é tocado com um arco?",
                    respostas: ["Guitarra", "Violino", "Piano", "Saxofone"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Quem é conhecido como a 'Rainha do Pop'?",
                    respostas: ["Beyoncé", "Madonna", "Lady Gaga", "Adele"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Qual destes álbuns é considerado um clássico do grunge?",
                    respostas: ["Nevermind", "OK Computer", "The Wall", "Rumours"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Quem compôs a famosa canção 'Bohemian Rhapsody'?",
                    respostas: ["John Lennon", "Freddie Mercury", "Mick Jagger", "Robert Plant"],
                    respostaCorreta: 1
                },
                {
                    pergunta: "Qual destes gêneros musicais é originário do Brasil?",
                    respostas: ["Samba", "Reggae", "Hip Hop", "Country"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Quem é o famoso guitarrista da banda Guns N' Roses?",
                    respostas: ["Slash", "Kirk Hammett", "Jimmy Page", "Eric Clapton"],
                    respostaCorreta: 0
                },
                {
                    pergunta: "Qual destes instrumentos é conhecido por seu som suave e melódico?",
                    respostas: ["Trombone", "Saxofone", "Guitarra Elétrica", "Bateria"],
                    respostaCorreta: 1
                }

            ];

            let perguntaAtualIndex = 0;
            let pontuacao = 0;

            iniciarJogoBtn.addEventListener('click', function () {
                iniciarJogoBtn.classList.add('oculto');
                jogoContainer.classList.remove('oculto');
                exibirPergunta();
            });

            function exibirPergunta() {
                esconderFeedback();
                limparBotoes();

                const perguntaAtual = perguntas[perguntaAtualIndex];
                perguntaContainer.textContent = perguntaAtual.pergunta;

                for (let i = 0; i < respostaBotoes.length; i++) {
                    respostaBotoes[i].textContent = perguntaAtual.respostas[i];
                    respostaBotoes[i].dataset.index = i;
                    respostaBotoes[i].disabled = false;
                    respostaBotoes[i].classList.remove('correta', 'incorreta');

                    respostaBotoes[i].onclick = function () {
                        verificarResposta(i);
                    };
                }
            }

            function verificarResposta(respostaSelecionadaIndex) {
                const perguntaAtual = perguntas[perguntaAtualIndex];
                const respostaCorretaIndex = perguntaAtual.respostaCorreta;
                const idUsuario = sessionStorage.ID_USUARIO; // Certifique-se de que esse valor está no sessionStorage
                const idPergunta = perguntaAtualIndex + 1; // Supondo que o índice representa a pergunta no banco

                const acertou = respostaSelecionadaIndex === respostaCorretaIndex;

                if (acertou) {
                    respostaBotoes[respostaSelecionadaIndex].classList.add('correta');
                    feedbackMensagem.textContent = "Você acertou! Mandou bem!";
                    pontuacao = pontuacao + 1;
                } else {
                    respostaBotoes[respostaSelecionadaIndex].classList.add('incorreta');
                    respostaBotoes[respostaCorretaIndex].classList.add('correta');
                    feedbackMensagem.textContent = "Que pena! A resposta correta era: \"" + perguntaAtual.respostas[respostaCorretaIndex] + "\".";
                }

                for (let i = 0; i < respostaBotoes.length; i++) {
                    respostaBotoes[i].disabled = true;
                }

                feedbackContainer.classList.remove('oculto');
                proximaPerguntaBtn.classList.remove('oculto');

                // Enviar resposta para o banco de dados
                fetch('/quiz/responder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id_usuario: idUsuario,
                        id_pergunta: idPergunta,
                        resposta_escolhida: respostaSelecionadaIndex,
                        correta: acertou
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            console.error('Erro ao salvar resposta no banco.');
                        }
                        atualizarGrafico(idPergunta); // <-- Atualiza o gráfico aqui!
                    })
                    .catch(error => {
                        console.error('Erro na requisição:', error);
                        atualizarGrafico(idPergunta); // <-- E aqui também!
                    });

            }

            proximaPerguntaBtn.addEventListener('click', (event) => {
                perguntaAtualIndex = perguntaAtualIndex + 1;

                if (perguntaAtualIndex < perguntas.length) {
                    exibirPergunta();
                } else {
                    mostrarResultadoFinal();
                }
            });

            function esconderFeedback() {
                feedbackContainer.classList.add('oculto');
                proximaPerguntaBtn.classList.add('oculto');
            }

            function limparBotoes() {
                for (let i = 0; i < respostaBotoes.length; i++) {
                    respostaBotoes[i].classList.remove('correta');
                    respostaBotoes[i].classList.remove('incorreta');
                    respostaBotoes[i].disabled = false;
                }
            }

            function mostrarResultadoFinal() {
                jogoContainer.classList.add('oculto');
                resultadoFinal.style.display = 'block';
                mensagemResultado.textContent = "Você acertou " + pontuacao + " de " + perguntas.length + " perguntas!";
            }
        });
    </script>
</body>

</html>